import { mock, mockClear } from 'jest-mock-extended';
import { nanoid } from 'nanoid';
import Player from '../lib/Player';
import { defaultLocation, getLastEmittedEvent } from '../TestUtils';
import ConversationArea from './ConversationArea';
import InteractableArea, { PLAYER_SPRITE_HEIGHT, PLAYER_SPRITE_WIDTH } from './InteractableArea';
class TestInteractableArea extends InteractableArea {
    handleCommand() {
        throw new Error('Method not implemented.');
    }
    toModel() {
        return { id: this.id, occupants: [], type: 'ConversationArea' };
    }
}
const HALF_W = PLAYER_SPRITE_WIDTH / 2;
const HALF_H = PLAYER_SPRITE_HEIGHT / 2;
describe('InteractableArea', () => {
    const testAreaBox = { x: 100, y: 100, width: 100, height: 100 };
    let testArea;
    const id = nanoid();
    let newPlayer;
    const townEmitter = mock();
    beforeEach(() => {
        mockClear(townEmitter);
        testArea = new TestInteractableArea(id, testAreaBox, townEmitter);
        newPlayer = new Player(nanoid(), mock());
        testArea.add(newPlayer);
    });
    describe('add', () => {
        it('Adds the player to the occupants list', () => {
            expect(testArea.occupantsByID).toEqual([newPlayer.id]);
        });
        it("Sets the player's conversationLabel and emits an update for their location", () => {
            expect(newPlayer.location.interactableID).toEqual(id);
            const lastEmittedMovement = getLastEmittedEvent(townEmitter, 'playerMoved');
            expect(lastEmittedMovement.location.interactableID).toEqual(id);
        });
    });
    describe('remove', () => {
        it('Removes the player from the list of occupants', () => {
            testArea.remove(newPlayer);
            expect(testArea.occupantsByID).toEqual([]);
        });
        it("Clears the player's conversationLabel and emits an update for their location", () => {
            mockClear(townEmitter);
            testArea.remove(newPlayer);
            expect(newPlayer.location.interactableID).toBeUndefined();
            const lastEmittedMovement = getLastEmittedEvent(townEmitter, 'playerMoved');
            expect(lastEmittedMovement.location.interactableID).toBeUndefined();
        });
    });
    describe('isActive', () => {
        it('Returns true when there are players in the area', () => {
            expect(testArea.isActive).toBe(true);
        });
        it('Returns false when there are no players in the area', () => {
            testArea.remove(newPlayer);
            expect(testArea.isActive).toBe(false);
        });
    });
    describe('addPlayersWithinBounds', () => {
        let playersInArea;
        let playersNotInArea;
        beforeEach(() => {
            playersInArea = [];
            playersNotInArea = [];
            const box = testArea.boundingBox;
            for (let i = 0; i < 10; i++) {
                const player = new Player(nanoid(), mock());
                player.location.x = box.x + box.width / 2;
                player.location.y = box.y + box.height / 2;
                playersInArea.push(player);
            }
            for (let i = 0; i < 10; i++) {
                const player = new Player(nanoid(), mock());
                player.location.x = -100;
                player.location.y = -100;
                playersNotInArea.push(player);
            }
            const mixedPlayers = playersInArea
                .concat(playersNotInArea)
                .sort((a, b) => a.id.localeCompare(b.id));
            testArea.addPlayersWithinBounds(mixedPlayers);
        });
        it('Does not include players not within the area', () => {
            playersNotInArea.forEach(player => expect(testArea.occupantsByID.includes(player.id)).toBe(false));
        });
        it('Includes all players that are within the area', () => {
            playersInArea.forEach(player => expect(testArea.occupantsByID.includes(player.id)).toBe(true));
            expect(playersInArea.length).toEqual(playersInArea.length);
        });
    });
    describe('contains', () => {
        const { x, y, width, height } = testAreaBox;
        it.each([
            { x: x + width / 2, y: y + width / 2 },
            { x: x + 10 + width / 2, y: y + 10 + width / 2 },
            { x: x - 1 + width, y: y + 1 },
            { x: x + 1, y: y + 1 },
            { x: x - 1 + width, y: y - 1 + height },
            { x: x + 1, y: y - 1 + height },
        ])('Returns true for locations that are inside of the area %p', (location) => {
            expect(testArea.contains({ ...defaultLocation(), x: location.x, y: location.y })).toBe(true);
        });
        it.each([
            { x: x - 1 + HALF_W + width, y: y + 1 - HALF_H },
            { x: x + 1 - HALF_W, y: y + 1 - HALF_H },
            { x: x - 1 + HALF_W + width, y: y - 1 + HALF_H + height },
            { x: x + 1 - HALF_W, y: y - 1 + HALF_H + height },
        ])('Returns true for locations that are outside of the area, but are included due to the player sprite size overlapping with the target area', (location) => {
            expect(testArea.contains({ ...defaultLocation(), x: location.x, y: location.y })).toBe(true);
        });
        it.each([
            { x: x + HALF_W + width, y: y - HALF_H },
            { x: x - HALF_W, y: y - HALF_H },
            { x: x + HALF_W + width, y: y + HALF_H + height },
            { x: x - HALF_W, y: y + HALF_H + height },
        ])('Returns false for locations that exactly hit the edge of the area', (location) => {
            expect(testArea.contains({ ...defaultLocation(), x: location.x, y: location.y })).toBe(false);
        });
        it.each([
            { x: x + width * 2, y: y - height },
            { x: x - width, y: y - width },
            { x: x + width * 2, y: y + height * 2 },
            { x: x - width, y: y + height * 2 },
            { x: x + 1, y: y - height },
            { x: x - width, y: y + 1 },
            { x: x + width * 2, y: y + 1 },
            { x: x + 1, y: y + height * 2 },
        ])('Returns false for locations that are outside of the area', (location) => {
            expect(testArea.contains({ ...defaultLocation(), x: location.x, y: location.y })).toBe(false);
        });
    });
    describe('overlaps', () => {
        const cheight = testAreaBox.height / 2;
        const cwidth = testAreaBox.width / 2;
        const cx = testAreaBox.x + cwidth;
        const cy = testAreaBox.y + cheight;
        const { x, y, height, width } = testAreaBox;
        it.each([
            { x: cx, y: cy, width: 2, height: 2 },
            { x: cx + 4, y: cy + 4, width: 2, height: 2 },
            { x: cx + 4, y: cy + 4, width: 2, height: 2 },
        ])('Returns true for locations that are contained entirely %p', (intersectBox) => {
            expect(testArea.overlaps(new ConversationArea({ id: 'testArea', occupants: [] }, intersectBox, mock()))).toBe(true);
        });
        it.each([
            { x: x - 50, y: y - 50, width: 100, height: 100 },
            { x: x - 50, y: y + height - 50, width: 100, height: 100 },
            { x: x + width - 50, y: y - 50, width: 100, height: 100 },
            { x: x + width - 50, y: y + height - 50, width: 100, height: 100 },
            {
                x: x - PLAYER_SPRITE_WIDTH / 2,
                y: y - PLAYER_SPRITE_HEIGHT / 2,
                width: PLAYER_SPRITE_WIDTH + 1,
                height: PLAYER_SPRITE_HEIGHT + 1,
            },
            {
                x: x - PLAYER_SPRITE_WIDTH / 2,
                y: y + height + PLAYER_SPRITE_HEIGHT / 2,
                width: PLAYER_SPRITE_WIDTH + 1,
                height: PLAYER_SPRITE_HEIGHT + 1,
            },
            {
                x: x + width + PLAYER_SPRITE_WIDTH / 2,
                y: y - PLAYER_SPRITE_HEIGHT / 2,
                width: PLAYER_SPRITE_WIDTH + 1,
                height: PLAYER_SPRITE_HEIGHT + 1,
            },
            {
                x: x + width + PLAYER_SPRITE_WIDTH / 2,
                y: y + height + PLAYER_SPRITE_HEIGHT / 2,
                width: PLAYER_SPRITE_WIDTH + 1,
                height: PLAYER_SPRITE_HEIGHT + 1,
            },
        ])('Returns true for locations that are overlapping with edges %p', (intersectBox) => {
            expect(testArea.overlaps(new ConversationArea({ id: 'testArea', occupants: [] }, intersectBox, mock()))).toBe(true);
        });
        it.each([
            { x: x - 50, y: y - 50, width: 10, height: 10 },
            { x: x - 50, y: y + height + 50, width: 10, height: 10 },
            { x: x + width + 50, y: y - 50, width: 100, height: 100 },
            { x: x + width + 50, y: y + height + 50, width: 100, height: 100 },
            {
                x: x - PLAYER_SPRITE_WIDTH * 1.5,
                y: y - PLAYER_SPRITE_HEIGHT * 1.5,
                width: PLAYER_SPRITE_WIDTH / 2,
                height: PLAYER_SPRITE_HEIGHT / 2,
            },
            {
                x: x - PLAYER_SPRITE_WIDTH,
                y: y + height + PLAYER_SPRITE_HEIGHT,
                width: PLAYER_SPRITE_WIDTH,
                height: PLAYER_SPRITE_HEIGHT,
            },
            {
                x: x + width + PLAYER_SPRITE_WIDTH,
                y: y - PLAYER_SPRITE_HEIGHT,
                width: PLAYER_SPRITE_WIDTH,
                height: PLAYER_SPRITE_HEIGHT,
            },
            {
                x: x + width + PLAYER_SPRITE_WIDTH,
                y: y + height + PLAYER_SPRITE_HEIGHT,
                width: PLAYER_SPRITE_WIDTH,
                height: PLAYER_SPRITE_HEIGHT,
            },
        ])('Returns false for locations that have no overlap %p', (intersectBox) => {
            expect(testArea.overlaps(new ConversationArea({ id: 'testArea', occupants: [] }, intersectBox, mock()))).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RhYmxlQXJlYS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Rvd24vSW50ZXJhY3RhYmxlQXJlYS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNoQyxPQUFPLE1BQU0sTUFBTSxlQUFlLENBQUM7QUFDbkMsT0FBTyxFQUFFLGVBQWUsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQVNwRSxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFDO0FBQ2xELE9BQU8sZ0JBQWdCLEVBQUUsRUFBRSxvQkFBb0IsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRWpHLE1BQU0sb0JBQXFCLFNBQVEsZ0JBQWdCO0lBQzFDLGFBQWE7UUFHbEIsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFTSxPQUFPO1FBQ1osT0FBTyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLGtCQUFrQixFQUFFLENBQUM7SUFDbEUsQ0FBQztDQUNGO0FBQ0QsTUFBTSxNQUFNLEdBQUcsbUJBQW1CLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLE1BQU0sTUFBTSxHQUFHLG9CQUFvQixHQUFHLENBQUMsQ0FBQztBQUV4QyxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLE1BQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDO0lBQ2hFLElBQUksUUFBMEIsQ0FBQztJQUMvQixN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QUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEcsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsSUFBSSxDQUFLO1lBQ1YsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUU7WUFDbkMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRTtZQUM5QixFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdkMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sRUFBRTtZQUMzQixFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzFCLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzlCLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1NBQ2hDLENBQUMsQ0FBQywwREFBMEQsRUFBRSxDQUFDLFFBQVksRUFBRSxFQUFFO1lBQzlFLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxlQUFlLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFD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